<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>문제 카드 생성기</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      margin-bottom: 20px;
    }
    .controls {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .controls input, .controls button, .controls select {
      margin: 5px;
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .controls button {
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    .controls button:hover {
      background: #45a049;
    }
    .export-btn {
      background: #2196F3 !important;
    }
    .export-btn:hover {
      background: #0b7dda !important;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(var(--cols), 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      background: #f1f9ff;
      font-size: 14px;
      min-height: 50px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .card b {
      font-size: 18px;
      margin-bottom: 8px;
      display: block;
    }
    .card input {
      width: 90%;
      padding: 5px;
      margin: auto;
    }
    .delete-btn {
      margin-top: 8px;
      padding: 3px 6px;
      font-size: 12px;
      color: red;
      border: none;
      background: none;
      cursor: pointer;
    }
    .section-title {
      margin-top: 40px;
      margin-bottom: 10px;
      font-weight: bold;
      font-size: 18px;
      background: white;
      padding: 10px 20px;
      border-radius: 8px;
    }
    
    /* 캡처될 영역 스타일 - 고정 너비 */
    #capture-area {
      background: white;
      padding: 30px;
      border-radius: 8px;
      margin-top: 20px;
      width: 1000px; /* 고정 너비 */
      margin-left: auto;
      margin-right: auto;
      box-sizing: border-box;
    }
    .capture-title {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
      color: #333;
      padding-bottom: 15px;
      border-bottom: 2px solid #4CAF50;
    }
    .title-input-group {
      margin-bottom: 10px;
    }
    .title-input-group label {
      display: inline-block;
      width: 100px;
      font-weight: bold;
    }
    .title-input-group input {
      width: 300px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>📝 문제 카드 생성기</h1>

  <!-- 컨트롤 영역 -->
  <div class="controls">
    <div class="title-input-group">
      <label>제목:</label>
      <input type="text" id="title" value="학습 문제" placeholder="카드 제목을 입력하세요" oninput="updateTitle()">
    </div>
    
    <div style="margin-top: 15px;">
      <label>총 문제 개수:</label>
      <input type="number" id="count" value="10" min="1" style="width:80px">
      <button onclick="generateCards()">빈 카드 생성</button>

      <label style="margin-left: 20px;">한 줄 개수:</label>
      <select id="cols" onchange="updateGrid()">
        <option value="5">5</option>
        <option value="10">10</option>
      </select>

      <button class="export-btn" onclick="exportPNG()">📥 PNG로 내보내기</button>
    </div>

    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
      <button onclick="document.getElementById('fileInput').click()">📁 파일에서 가져오기 (txt)</button>
      <input type="file" id="fileInput" accept=".txt" style="display:none" onchange="loadFromFile(event)">
      
      <button onclick="toggleBulkInput()" style="margin-left: 10px;">✍️ 일괄 입력</button>
      <button onclick="clearAll()" style="margin-left: 10px; background: #f44336;">🗑️ 전체 지우기</button>
    </div>

    <!-- 일괄 입력 영역 -->
    <div id="bulk-input-area" style="display:none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
      <div style="margin-bottom: 10px;">
        <strong>💡 한 줄에 하나씩 입력하세요</strong> (예: 1번 문제, 2번 문제, 3번 문제...)
      </div>
      <textarea id="bulk-text" rows="10" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" placeholder="문제1&#10;문제2&#10;문제3&#10;..."></textarea>
      <div style="margin-top: 10px;">
        <button onclick="applyBulkInput()">✅ 적용하기</button>
        <button onclick="toggleBulkInput()" style="background: #999;">취소</button>
      </div>
    </div>
  </div>

  <!-- 편집 영역 -->
  <div class="section-title">✏️ 편집 영역</div>
  <div id="editor" class="grid" style="--cols:5"></div>

  <!-- 캡처될 영역 -->
  <div class="section-title">👁️ 미리보기 (제목 포함하여 이 영역이 PNG로 저장됩니다)</div>
  <div id="capture-area">
    <div class="capture-title" id="preview-title">학습 문제</div>
    <div id="preview" class="grid" style="--cols:5"></div>
  </div>

  <!-- html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let items = [];

    // 카드 일괄 생성
    function generateCards() {
      const count = parseInt(document.getElementById("count").value);
      items = new Array(count).fill("");
      renderEditor();
      renderPreview();
    }

    // 편집 영역 렌더링
    function renderEditor() {
      const editor = document.getElementById("editor");
      editor.innerHTML = "";
      items.forEach((text, idx) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <b>${idx+1}</b>
          <input type="text" value="${text}" 
            oninput="updateText(${idx}, this.value)" placeholder="문제 텍스트 입력">
          <button class="delete-btn" onclick="deleteCard(${idx})">삭제</button>
        `;
        editor.appendChild(div);
      });
    }

    // 미리보기 영역 렌더링
    function renderPreview() {
      const preview = document.getElementById("preview");
      preview.innerHTML = "";
      items.forEach((text, idx) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<b>${idx+1}</b><div>${text}</div>`;
        preview.appendChild(div);
      });
    }

    // 텍스트 업데이트
    function updateText(index, value) {
      items[index] = value;
      renderPreview();
    }

    // 제목 업데이트
    function updateTitle() {
      const title = document.getElementById("title").value;
      document.getElementById("preview-title").textContent = title || "학습 문제";
    }

    // 개별 카드 삭제
    function deleteCard(index) {
      items.splice(index, 1);
      renderEditor();
      renderPreview();
    }

    // 그리드 열 개수 업데이트
    function updateGrid() {
      const cols = document.getElementById("cols").value;
      document.getElementById("editor").style.setProperty("--cols", cols);
      document.getElementById("preview").style.setProperty("--cols", cols);
    }

    // PNG 내보내기 (개선된 버전)
    function exportPNG() {
      const captureArea = document.getElementById("capture-area");
      const title = document.getElementById("title").value || "학습문제";
      
      // 캡처 옵션 설정
      const options = {
        backgroundColor: '#ffffff',
        scale: 2, // 고해상도
        logging: false,
        useCORS: true,
        allowTaint: true,
        scrollY: -window.scrollY,
        scrollX: -window.scrollX,
        windowWidth: document.documentElement.scrollWidth,
        windowHeight: document.documentElement.scrollHeight
      };
      
      html2canvas(captureArea, options).then(canvas => {
        const link = document.createElement("a");
        const filename = `${title}_${new Date().toISOString().slice(0,10)}.png`;
        link.download = filename;
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    }

    // 초기 로드 시 카드 생성
    window.onload = function() {
      generateCards();
    };

    // 일괄 입력 영역 토글
    function toggleBulkInput() {
      const bulkArea = document.getElementById("bulk-input-area");
      if (bulkArea.style.display === "none") {
        bulkArea.style.display = "block";
        // 현재 내용을 텍스트로 표시
        document.getElementById("bulk-text").value = items.join("\n");
      } else {
        bulkArea.style.display = "none";
      }
    }

    // 일괄 입력 적용
    function applyBulkInput() {
      const text = document.getElementById("bulk-text").value;
      const lines = text.split("\n"); // 빈 줄도 유지
      items = lines;
      renderEditor();
      renderPreview();
      toggleBulkInput();
    }

    // 파일에서 불러오기
    function loadFromFile(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        const lines = text.split("\n"); // 빈 줄도 유지
        items = lines;
        renderEditor();
        renderPreview();
        alert(`${lines.length}개의 카드를 불러왔습니다!`);
      };
      reader.readAsText(file, "UTF-8");
      
      // 파일 입력 초기화 (같은 파일 재선택 가능하도록)
      event.target.value = "";
    }

    // 전체 지우기
    function clearAll() {
      if (confirm("모든 카드를 지우시겠습니까?")) {
        items = [];
        renderEditor();
        renderPreview();
      }
    }
  </script>
</body>
</html>
